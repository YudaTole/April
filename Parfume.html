<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Penjualan Parfum</title>
  <style>
    body {
      margin: 0; font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #2c3e50, #34495e); color: #fff;
    }
    .container {
      max-width: 700px; margin: 20px auto; background: #1e272e;
      padding: 20px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    h2 { text-align: center; margin-bottom: 20px; }
    input, select, button {
      width: 100%; padding: 10px; margin: 10px 0;
      border: none; border-radius: 8px; font-size: 14px;
    }
    input, select { background: #2d3436; color: #fff; }
    button { background: #0984e3; color: white; cursor: pointer; font-weight: bold; }
    button:hover { background: #74b9ff; }
    .hidden { display: none; }
    .table-wrapper { overflow-x: auto; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 15px; min-width: 650px;
    }
    th, td {
      border: 1px solid #555; padding: 8px; text-align: center;
    }
    th { background: #0984e3; }
    .logout { background: #d63031; margin-top: 10px; }
    .logout:hover { background: #ff7675; }
    .hapusBtn, .editBtn {
      padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;
    }
    .hapusBtn { background: #d63031; color: #fff; }
    .hapusBtn:hover { background: #ff7675; }
    .editBtn { background: #00b894; color: #fff; margin-left: 5px; }
    .editBtn:hover { background: #55efc4; }
    .exportBtn { background: #6c5ce7; margin-top: 10px; }
    .exportBtn:hover { background: #a29bfe; }
  </style>
</head>
<body>
  <div class="container" id="authPage">
    <h2>Login / Register</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
  </div>

  <div class="container hidden" id="mainPage">
    <h2>Penjualan Parfum</h2>
    <input type="text" id="namaPembeli" placeholder="Nama Pembeli">

    <!-- Ganti dari input text ke dropdown -->
    <select id="namaBibit">
      <option value="">Pilih Bibit Parfum</option>
      <option value="Zara Man">Zara Man</option>
      <option value="Dior Sauvage">Dior Sauvage</option>
      <option value="Chanel Bleu">Chanel Bleu</option>
      <option value="Aigner Black">Aigner Black</option>
      <option value="Baccarat Rouge">Baccarat Rouge</option>
    </select>

    <select id="mili">
      <option value="">Pilih Ukuran Botol (ml)</option>
      <option value="4">4 ml</option>
      <option value="8">8 ml</option>
      <option value="10">10 ml</option>
    </select>
    <select id="kualitas">
      <option value="">Pilih Kualitas</option>
      <option value="Murni">Murni</option>
      <option value="Premium">Premium</option>
      <option value="Sedang">Sedang</option>
      <option value="Standar">Standar</option>
    </select>
    <input type="text" id="harga" placeholder="Harga otomatis" readonly>
    <button onclick="tambahTransaksi()">Tambah Transaksi</button>
    <button class="logout" onclick="logout()">Logout</button>
    <button class="exportBtn" onclick="exportExcel()">Export ke Excel</button>
    <button class="exportBtn" onclick="exportPDF()">Export ke PDF</button>

    <h3>Daftar Transaksi</h3>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Pembeli</th>
            <th>Bibit</th>
            <th>Ukuran</th>
            <th>Kualitas</th>
            <th>Harga</th>
            <th>Tanggal</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="transaksiList"></tbody>
      </table>
    </div>

    <h3>Total Penjualan: <span id="totalPenjualan">Rp 0</span></h3>
  </div>

  <!-- jsPDF + AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <!-- SheetJS untuk Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    const hargaTabel = {
      4: { Murni: 10000, Premium: 8500, Sedang: 7500, Standar: 4500 },
      8: { Murni: 20000, Premium: 16500, Sedang: 13500, Standar: 9500 },
      10: { Murni: 25000, Premium: 21000, Sedang: 21000, Standar: 12000 }
    };

    const authPage = document.getElementById("authPage");
    const mainPage = document.getElementById("mainPage");
    let editIndex = null;

    if(localStorage.getItem("loggedInUser")){
      authPage.classList.add("hidden");
      mainPage.classList.remove("hidden");
      renderTransaksi();
    }

    function login(){
      let user = document.getElementById("username").value;
      let pass = document.getElementById("password").value;
      let savedUser = localStorage.getItem("user_" + user);
      if(savedUser && JSON.parse(savedUser).password === pass){
        localStorage.setItem("loggedInUser", user);
        authPage.classList.add("hidden");
        mainPage.classList.remove("hidden");
        renderTransaksi();
      } else {
        alert("Username / Password salah!");
      }
    }

    function register(){
      let user = document.getElementById("username").value;
      let pass = document.getElementById("password").value;
      if(localStorage.getItem("user_" + user)){
        alert("Username sudah ada!");
        return;
      }
      localStorage.setItem("user_" + user, JSON.stringify({username: user, password: pass}));
      alert("Register berhasil, silakan login.");
    }

    function logout(){
      localStorage.removeItem("loggedInUser");
      location.reload();
    }

    document.getElementById("mili").addEventListener("change", hitungHarga);
    document.getElementById("kualitas").addEventListener("change", hitungHarga);

    function hitungHarga(){
      let ml = document.getElementById("mili").value;
      let kualitas = document.getElementById("kualitas").value;
      if(ml && kualitas){
        document.getElementById("harga").value = "Rp " + hargaTabel[ml][kualitas].toLocaleString();
      }
    }

    function tambahTransaksi(){
      let pembeli = document.getElementById("namaPembeli").value;
      let bibit = document.getElementById("namaBibit").value;
      let ml = document.getElementById("mili").value;
      let kualitas = document.getElementById("kualitas").value;
      if(!pembeli || !bibit || !ml || !kualitas){
        alert("Lengkapi semua data!");
        return;
      }
      let harga = hargaTabel[ml][kualitas];
      let now = new Date();
      let options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      let tanggal = now.toLocaleDateString('id-ID', options);

      let transaksi = JSON.parse(localStorage.getItem("transaksi")) || [];

      if(editIndex !== null){
        transaksi[editIndex] = {pembeli, bibit, ml, kualitas, harga, tanggal};
        editIndex = null;
      } else {
        transaksi.push({pembeli, bibit, ml, kualitas, harga, tanggal});
      }

      localStorage.setItem("transaksi", JSON.stringify(transaksi));
      renderTransaksi();

      document.getElementById("namaPembeli").value = "";
      document.getElementById("namaBibit").value = "";
      document.getElementById("mili").value = "";
      document.getElementById("kualitas").value = "";
      document.getElementById("harga").value = "";
    }

    function renderTransaksi(){
      let transaksi = JSON.parse(localStorage.getItem("transaksi")) || [];
      let list = document.getElementById("transaksiList");
      list.innerHTML = "";
      let total = 0;
      transaksi.forEach((t, index) => {
        total += t.harga;
        list.innerHTML += `<tr>
          <td>${t.pembeli}</td>
          <td>${t.bibit}</td>
          <td>${t.ml} ml</td>
          <td>${t.kualitas}</td>
          <td>Rp ${t.harga.toLocaleString()}</td>
          <td>${t.tanggal}</td>
          <td>
            <button class="hapusBtn" onclick="hapusTransaksi(${index})">Hapus</button>
            <button class="editBtn" onclick="editTransaksi(${index})">Edit</button>
          </td>
        </tr>`;
      });
      document.getElementById("totalPenjualan").innerText = "Rp " + total.toLocaleString();
    }

    function hapusTransaksi(index){
      let transaksi = JSON.parse(localStorage.getItem("transaksi")) || [];
      transaksi.splice(index, 1);
      localStorage.setItem("transaksi", JSON.stringify(transaksi));
      renderTransaksi();
    }

    function editTransaksi(index){
      let transaksi = JSON.parse(localStorage.getItem("transaksi")) || [];
      let t = transaksi[index];
      document.getElementById("namaPembeli").value = t.pembeli;
      document.getElementById("namaBibit").value = t.bibit;
      document.getElementById("mili").value = t.ml;
      document.getElementById("kualitas").value = t.kualitas;
      document.getElementById("harga").value = "Rp " + t.harga.toLocaleString();
      editIndex = index;
    }

    // Export Excel & PDF sama seperti versi sebelumnya...
    function exportExcel(){
      let transaksi = JSON.parse(localStorage.getItem("transaksi")) || [];
      let total = transaksi.reduce((sum, t) => sum + t.harga, 0);
      let data = [["No", "Pembeli", "Bibit", "Ukuran", "Kualitas", "Harga", "Tanggal"]];
      transaksi.forEach((t, i) => {
        data.push([i+1, t.pembeli, t.bibit, t.ml + " ml", t.kualitas, t.harga, t.tanggal]);
      });
      data.push(["", "", "", "", "Total", total, ""]);
      let ws = XLSX.utils.aoa_to_sheet(data);
      let wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Transaksi");
      XLSX.writeFile(wb, "transaksi.xlsx");
    }

    function exportPDF(){
      const { jsPDF } = window.jspdf;
      let doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("Laporan Penjualan Parfum", 14, 15);
      let transaksi = JSON.parse(localStorage.getItem("transaksi")) || [];
      let total = transaksi.reduce((sum, t) => sum + t.harga, 0);
      let rows = transaksi.map((t, i) => [
        i+1, t.pembeli, t.bibit, t.ml + " ml", t.kualitas, "Rp " + t.harga.toLocaleString(), t.tanggal
      ]);
      doc.autoTable({
        head: [["No", "Pembeli", "Bibit", "Ukuran", "Kualitas", "Harga", "Tanggal"]],
        body: rows,
        startY: 25,
        styles: { fontSize: 10 },
        headStyles: { fillColor: [9,132,227] }
      });
      doc.text("Total Penjualan: Rp " + total.toLocaleString(), 14, doc.lastAutoTable.finalY + 10);
      doc.save("transaksi.pdf");
    }
  </script>
</body>
</html>
